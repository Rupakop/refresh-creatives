<!doctype html>
<html>
<head>
  <title>Explore Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-white">

<header class="fixed top-0 left-0 right-0 bg-black/80 backdrop-blur z-50">
  <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
    <h1 class="font-bold">Explore Collection</h1>
    <a href="checkout.html" class="border px-4 py-2 rounded">
      View Cart (<span id="cartCount">0</span>)
    </a>
  </div>
</header>

<div class="pt-24 max-w-6xl mx-auto px-6">
  <input id="search"
    placeholder="Search perfumes..."
    class="w-full md:w-1/2 p-2 bg-neutral-800 rounded">
</div>

<section class="max-w-6xl mx-auto px-6 py-12">
  <div id="grid"
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
  </div>
</section>

<script type="module">
import { PERFUMES } from "./perfumes.js";
import { SIZES } from "./data.js";

/* CART */
function getCart(){ return JSON.parse(localStorage.getItem("cart")||"[]"); }
function setCart(c){ localStorage.setItem("cart",JSON.stringify(c)); update(); }
function update(){
  document.getElementById("cartCount").textContent =
    getCart().reduce((s,i)=>s+i.qty,0);
}
function addToCart(p,size){
  const cart=getCart();
  const f=cart.find(i=>i.id===p.id && i.size===size.ml);
  f ? f.qty++ : cart.push({
    id:p.id,name:p.name,size:size.ml,price:size.price,qty:1
  });
  setCart(cart);
}

/* RENDER */
function render(){
  grid.innerHTML="";
  const q=search.value.toLowerCase();

  PERFUMES.filter(p=>p.name.toLowerCase().includes(q))
    .forEach(p=>{
      let size=SIZES[0];
      const c=document.createElement("div");
      c.className="border border-white/10 p-5 rounded-xl";

      c.innerHTML=`
        <img src="${size.image}" class="h-40 mx-auto mb-4">
        <h4 class="font-semibold">${p.name}</h4>
        <p class="text-sm text-white/60">${p.scentProfile}</p>

        <select class="mt-3 w-full bg-black border p-2">
          ${SIZES.map(s=>`<option value="${s.ml}">${s.ml}ml — ₹${s.price}</option>`).join("")}
        </select>

        <div class="mt-4 grid grid-cols-2 gap-3">
          <button class="add bg-neutral-800 py-2 rounded">Add to Cart</button>
          <button class="buy bg-pink-600 py-2 rounded">Buy Now</button>
        </div>
      `;

      const img=c.querySelector("img");
      const sel=c.querySelector("select");
      sel.onchange=()=>{ size=SIZES.find(s=>s.ml==sel.value); img.src=size.image; };

      c.querySelector(".add").onclick=()=>addToCart(p,size);
      c.querySelector(".buy").onclick=()=>{ addToCart(p,size); location.href="checkout.html"; };

      grid.appendChild(c);
    });
}

search.oninput=render;
render();
update();
</script>

</body>
</html>
