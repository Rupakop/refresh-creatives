<!doctype html>
<html>
<head>
  <title>Explore Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-white">

<header class="max-w-6xl mx-auto px-6 py-10">
  <h1 class="text-4xl font-bold">Explore Collection</h1>

  <div class="mt-6 flex gap-4">
    <input id="search"
      placeholder="Search perfumes..."
      class="flex-1 p-2 bg-neutral-800 rounded">

    <a href="checkout.html"
      class="border px-4 py-2 rounded">
      View Cart (<span id="cartCount">0</span>)
    </a>
  </div>
</header>

<section class="max-w-6xl mx-auto px-6 pb-20">
  <div id="grid"
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
  </div>
</section>

<script type="module">
import { PERFUMES } from "./perfumes.js";
import { SIZES } from "./data.js";

/* CART */
function getCart(){return JSON.parse(localStorage.getItem("cart")||"[]");}
function setCart(c){localStorage.setItem("cart",JSON.stringify(c));update();}
function update(){
  document.getElementById("cartCount").textContent =
    getCart().reduce((s,i)=>s+i.qty,0);
}
function addToCart(p,size){
  const cart=getCart();
  const f=cart.find(i=>i.id===p.id && i.size===size.ml);
  f?f.qty++:cart.push({
    id:p.id,name:p.name,size:size.ml,price:size.price,qty:1
  });
  setCart(cart);
}

/* RENDER */
function render(){
  grid.innerHTML="";
  const q=search.value.toLowerCase();
  PERFUMES.filter(p=>p.name.toLowerCase().includes(q))
    .forEach(p=>{
      let size=SIZES[0];
      const c=document.createElement("div");
      c.className="border border-white/10 p-5 rounded-xl";

      c.innerHTML=`
        <img src="${size.image}" class="h-40 mx-auto mb-4">
        <h3 class="font-semibold">${p.name}</h3>
        <p class="text-sm text-white/60">${p.scentProfile}</p>

        <select class="mt-3 w-full bg-black border p-2">
          ${SIZES.map(s=>`<option value="${s.ml}">${s.ml}ml — ₹${s.price}</option>`).join("")}
        </select>

        <div class="mt-4 flex gap-3">
          <button class="add border py-2 rounded flex-1">
            Add to Cart
          </button>
          <button class="buy bg-pink-600 py-2 rounded flex-1">
            Buy Now
          </button>
        </div>
      `;

      const img=c.querySelector("img");
      const sel=c.querySelector("select");
      sel.onchange=()=>{size=SIZES.find(s=>s.ml==sel.value);img.src=size.image;};

      c.querySelector(".add").onclick=()=>addToCart(p,size);
      c.querySelector(".buy").onclick=()=>{addToCart(p,size);location.href="checkout.html";};

      grid.appendChild(c);
    });
}

search.oninput=render;
render();
update();
</script>

</body>
</html>
